#!/usr/bin/env node
const fs = require('fs');
const colors = require('colors');
const headerReg = /^(feat|fix|style):/;

// 封装 log 方法
const logger = {
  info(msg){
    console.log(colors.green(msg));
  },
  warn(msg){
    console.log(colors.yellow(msg));
  },
  error(msg){
    console.log(colors.red(msg));
  }
};

// 获取 commit-msg 文本
let getMsg = function() {
  return new Promise((resolve, reject) => {
    let msgFile = process.argv[2];
    fs.readFile(msgFile, (err, data) => {
      if (err) reject(err);
      else resolve(data);
    })
  })
}

// 正则校验
let regTest = function(msg) {
  let isLegal = headerReg.test(msg);
  if (isLegal) {
    logger.info(" --> msg 校验通过 ");
  } else {
    logger.error(" --> 该 msg 不符合规范，请在 msg 首部添加 ( feat | fix | style ) 字段 ");
  }
  return isLegal;
}

async function main () {
  let msg = await getMsg();
  logger.info(`\n --> commit-msg 为 ${msg}`);
  let regRes = regTest(msg);
  if (regRes) {
    process.exit(0);
  } else {

  }

  
}

main();



